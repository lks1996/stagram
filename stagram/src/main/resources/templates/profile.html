<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://kit.fontawesome.com/8437d7db58.js" crossorigin="anonymous"></script>
<script
        src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
        crossorigin="anonymous">
</script>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Instagram</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/profile.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/sideMenu.css}">

</head>
<body>
<!-- side menu -->
<div class="side_menu" th:replace="~{/fragment/sideMenu :: sideMenuFragment}">
</div>

<section>
    <main>
        <div class="a">
            <header>
                <div class="a_1">
                    <div class="a_2">
                        <div class="a_3">
                            <button id="btn-modal" th:disabled="${profileChangeBtn_disabled}">

                                <img th:src="@{/user/display(id = ${user.id})}" alt="" style="width: 150px; height: 150px;">
                            </button>
                        </div>
                    </div>
                </div>

                <section class="s_1">
                    <div class="b_1">
                        <h2><td th:text="${user.id}"></h2>
                        <div class="b_2">
                            <div class="b_3">
                                <a href='/user/edit' th:hidden="${hiddenProfileEditBtn}"> 프로필 편집</a>
                                <button class="follow-btn" th:hidden="${hiddenFollowBtn}">Follow</button>

                            </div>
                        </div>
                        <div class="c_1">
                            <button class="profile-settings-btn" id="btn-modal2" th:hidden="${hiddenProfileEditBtn}" aria-label="profile settings"><i class="fas fa-cog" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    <div class="space">
                        <div></div>
                    </div>

                    <ul>
                        <li>
                            <div class="d_1">
                                게시글
                                <span>
                                    <span><td th:text="${postCount}"></span>
                                </span>
                            </div>
                        </li>
                        <li>
                            <a class="a_tag_1">
                                <div class="d_1">
                                    팔로워
                                    <span>
                                        <span>
                                            130
                                        </span>
                                    </span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="a_tag_1">
                                <div class="d_1">
                                    팔로우
                                    <span>
                                        <span>
                                            10
                                        </span>
                                    </span>
                                </div>
                            </a>
                        </li>

                    </ul>

                    <div class="e_1">
                        <span><td th:text="${user.name}"></td></span>
                        <h1><td th:text="${user.bio}"></h1>

                    </div>

                </section>
            </header>

            <div class="space2">
                <div></div>
            </div>

            <div class="gallery">
                <article class="article_gallery">
                    <div>
                        <div class="f_1">
<!--                            <div th:block th:each="userPost, userPostStat : ${userPosts}">-->

<!--                                <div class="f_3" th:if="${(userPostStat.index+1) % 3 != 1}">-->
                                    <div class="gallery-item" tabindex="0" th:each="userPost: ${userPosts}">

                                        <img th:src="@{/post/display(postName = ${userPost.postImgName})}"
                                             class="gallery-image" alt="">

                                        <div class="gallery-item-info">

                                            <ul>
                                                <li class="gallery-item-likes"><span
                                                        class="visually-hidden">Likes:</span><i class="fas fa-heart"
                                                                                                aria-hidden="true"></i>
                                                    56
                                                </li>
                                                <li class="gallery-item-comments"><span class="visually-hidden">Comments:</span><i
                                                        class="fas fa-comment" aria-hidden="true"></i> 2
                                                </li>
                                            </ul>

                                        </div>

                                    </div>


<!--                                </div>-->

<!--                            </div>-->
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </main>
</section>



<!-- Modal Windows-->
<div id="modal_for_profile_img" class="modal-overlay">
    <div class="modal-window">
        <div class="title">
            <h3>프로필 사진 바꾸기</h3>
        </div>
        <div class="content">
            <button class="profile-upload-btn">
                사진 업로드
            </button>
            <button class="profile-delete-btn" onclick = "location.href = '/delete/profileImg'" >
                현재 사진 삭제
            </button>
            <button class="cancel-btn">
                취소
            </button>
        </div>
        <form id="upload-profile-pic-form" action="/upload/profile" method="post" enctype="multipart/form-data">
            <input type="file" id="profileImg" name="profileImg" style="display:none;" onchange="changeValue(this)">
        </form>
    </div>
</div>


<div id="modal_for_profile_setting" class="modal-overlay">
    <div class="modal-window">
        <div class="content">
            <button class="logout-btn" onclick = "location.href = '/logout'" >
                로그아웃
            </button>
            <button class="cancel-btn2">
                취소
            </button>
        </div>
    </div>
</div>


<div id="modal_for_post" class="modal-overlay">
    <div id="modal_window" class="modal-window">
        <div class="title">
            <div class="div_h3">
                <h3>새 게시물 만들기</h3>
            </div>
            <div class="nextBtn_div">
                <button id="nextBtn" onclick="visibleContents()">다음</button>
                <button id="shareBtn" style="display: none;" onclick="form_submit()">공유</button>
            </div>
        </div>
        <div class="data_space">
            <div class="content">
                <div class="space">
                    <img id="preview" style="display:none;"/>
                    <button class="select-img-btn" id="select-img-btn">
                        컴퓨터에서 선택
                    </button>
                </div>
            </div>
            <div class="content_text">
                <div class="text_space">
                    <input type="text" id="postContents" name="postContents" style="display:none;" placeholder="문구 입력...">
                </div>
            </div>
        </div>
        <form id="upload-post-pic-form" action="/upload/post" method="post" enctype="multipart/form-data">
            <input type="file" id="postImg" name="postImg" accept=".gif, .jpg, .png, .jpeg" style="display:none;" onchange="readURL(this)">
            <input type="text" id="postContentsInForm" name="postContentsInForm" style="display:none;">
        </form>
    </div>
</div>

<script>
const modal = document.getElementById("modal_for_profile_img")
const btnModal = document.getElementById("btn-modal")

function modalOn() {
    modal.style.display = "flex"
}

function isModalOn() {
    return modal.style.display === "flex"
}

function modalOff() {
    modal.style.display = "none"
}

btnModal.addEventListener("click", e => {
    modalOn()
})

const closeBtn = modal.querySelector(".cancel-btn")
closeBtn.addEventListener("click", e => {
    modalOff()
})

modal.addEventListener("click", e => {
    const evTarget = e.target
    if(evTarget.classList.contains("modal-overlay")) {
        modalOff()
    }
})









<!--톱니바퀴(프로필 옆에)-->
const modal2 = document.getElementById("modal_for_profile_setting")
const btnModal2 = document.getElementById("btn-modal2")
const closeBtn2 = modal2.querySelector(".cancel-btn2")

function modalOn2() {
    modal2.style.display = "flex"
}

function isModalOn2() {
    return modal2.style.display === "flex"
}

function modalOff2() {
    modal2.style.display = "none"
}

btnModal2.addEventListener("click", e => {
    modalOn2()
})

closeBtn2.addEventListener("click", e => {
    modalOff2()
})

modal2.addEventListener("click", e => {
    const evTarget = e.target
    if(evTarget.classList.contains("modal-overlay")) {
        modalOff2()
    }
})

$('.profile-upload-btn').click(function (e) {
    $('#profileImg').click();
});

function changeValue(obj){

    document.getElementById('upload-profile-pic-form').submit();
}

const modal3 = document.getElementById("modal_for_post")
const modal_window = document.getElementById("modal_window")
const btnModal3 = document.getElementById("post-btn-modal")
const btnSelectImg = document.getElementById("select-img-btn")
const preview = document.getElementById("preview")
const nextBtn = document.getElementById("nextBtn")
const shareBtn = document.getElementById("shareBtn")
const postContents = document.getElementById("postContents")
const postContentsInForm = document.getElementById('postContentsInForm')

function modal3On() {
    modal3.style.display = "flex"
    btnSelectImg.style.display = "flex"
}

function modal3Off() {
    modal3.style.display = "none"
    preview.src = "";
    preview.style.display = "none"
    nextBtn.style.display = "none"
    modal_window.style.width = "";
    shareBtn.style.display = "none";
    postContents.style.display = "none";
    postContentsInForm.value = "";
}

function isModal3On() {
    return modal3.style.display === "flex"
}

btnModal3.addEventListener("click", e => {
    modal3On()
})

modal3.addEventListener("click", e => {
    const evTarget = e.target
    if(evTarget.classList.contains("modal-overlay")) {
        modal3Off()
    }
})


$('.select-img-btn').click(function (e) {
    $('#postImg').click();
});


function readURL(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
    preview.style.display = "flex";
    btnSelectImg.style.display = "none";
    nextBtn.style.display = "flex";
  }
 else {
    preview.src = "";
  }
}

function visibleContents(){
    modal_window.style.width = "900px";
    nextBtn.style.display = "none";
    shareBtn.style.display = "flex";
    postContents.style.display = "flex";
}


function form_submit(){
    postContentsInForm.value = postContents.value;
    document.getElementById('upload-post-pic-form').submit();

}



</script>
</body>
</html>